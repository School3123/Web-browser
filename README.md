作成した「Codespaces型リモートブラウザ」の取扱説明書（マニュアル）をまとめました。

---

# 🚀 Python リモートブラウザ 取扱説明書 (Codespaces版)

このプロジェクトは、GitHub Codespaces（Linuxサーバー）上で動作する**Firefox**を、あなたのローカルブラウザからリモート操作するシステムです。

## 1. システムの仕組み
*   **エンジン (Firefox):** サーバー内部で動作し、正規のWebサイトにアクセスします。
*   **配信 (MJPEG Stream):** 画面を高品質なJPEGの連続としてストリーミング配信します。Base64変換を介さないため、高速かつ低負荷です。
*   **操作転送:** あなたのクリック、スクロール、キー入力をサーバー側のFirefoxにリアルタイムで転送します。

---

## 2. セットアップ手順（初回のみ）

GitHub Codespacesのターミナルで以下のコマンドを順番に実行してください。

```bash
# 1. 必要なライブラリのインストール
pip install flask playwright cryptography pyOpenSSL

# 2. Firefox本体のインストール
playwright install firefox

# 3. Linuxシステム依存ファイルのインストール
sudo playwright install-deps firefox
```

---

## 3. 起動方法

1.  ターミナルでプログラムを実行します。
    ```bash
    python app.py
    ```
2.  画面右下に **「A service is running on port 5000. Open in Browser」** と表示されたら、**「Open in Browser」** をクリックします。
3.  **HTTPSの警告画面**が表示されます。
    *   これは自己署名証明書（adhoc）を使用しているためです。
    *   **「詳細設定」** → **「～に移動する（安全ではありません）」** をクリックして進んでください。

---

## 4. 基本操作

*   **URL移動:** 画面上部の入力欄にURLを入れ、「Go」ボタンを押すか、Enterキーを押します。
*   **クリック:** 表示されている画像内を直接クリックします。
*   **スクロール:** マウスホイール、またはタッチパッドの2本指スクロールがそのまま反映されます。
*   **キー入力:** 基本的に、入力欄以外の場所でキーを押すとサーバー側へ転送されます。
*   **画面サイズ:** ウィンドウの大きさを変えると、画像が自動的に追従してフィットします。

---

## 5. 主な仕様
| 項目 | 設定値 |
| :--- | :--- |
| **ブラウザエンジン** | Firefox (Playwright経由) |
| **内部解像度** | 1920x1080 (Full HD) |
| **画像形式** | MJPEG (品質: 85) |
| **セキュリティ** | HTTPS (Self-signed) |
| **座標計算** | 画面サイズに合わせた自動アスペクト比補正 |

---

## 6. トラブルシューティング

### Q. 画像の中に「？」が表示される・真っ白なまま
*   **解決:** Codespacesの「Ports」タブを開き、Port 5000の **Visibility** を `Private` から **`Public`** に変更してください。

### Q. 「Bad request version」等のエラーが出る
*   **解決:** ブラウザがHTTPSで接続しようとしているのに、以前のHTTP設定が残っている場合があります。一度URLバーを `https://` で始まっているか確認してください。また、`pip install cryptography` が完了しているか確認してください。

### Q. 動作が非常に重い
*   **解決:** プログラム内の `quality=85` を `quality=40` 程度に下げると、画質は落ちますが転送速度が向上します。

### Q. キーボード入力が効かない
*   **解決:** URL入力欄にフォーカスが当たっている（カーソルが点滅している）間は、キーボード操作はサーバーに転送されません。画像部分を一度クリックしてからキーを入力してください。

---

## 7. 注意事項
*   **Googleログイン等:** 高度なセキュリティを持つサイトでは、リモート操作を「ボット」と判定してブロックする場合があります。
*   **リソース消費:** ブラウザをサーバーで動かし続けるため、CodespacesのCPU/メモリを消費します。使用後はターミナルで `Ctrl + C` を押して停止させてください。
